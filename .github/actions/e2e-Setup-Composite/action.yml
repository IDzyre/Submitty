name: 'SetUpForE2e'
descriptions: 'Uses the composite action to copy and set up our e2e Selenium and cypress tests'

env:
  PGPASSWORD: submitty_dbuser
  PHP_USER: submitty_php
  PHP_GROUP: submitty_php
  CGI_USER: submitty_cgi
  SUBMITTY_DATA_DIR: /var/local/submitty
  SUBMITTY_INSTALL_DIR: /usr/local/submitty
  SUBMITTY_REPOSITORY: /usr/local/submitty/GIT_CHECKOUT/Submitty
  POSTGRES_HOST: localhost
  PHP_VER: 8.1
  NODE_VERSION: 16
  PYTHON_VERSION: "3.10"

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
      with:
        path: SUBMITTY_CPY/
    - name: install vagrant
      run: |
        wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
        echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
        sudo apt update && sudo apt install vagrant
    - name: Vagrant up
      run: vagrant up
      shell: bash
    - name: Run git tests
      run: vagrant ssh -c 'bash tests/git_test.sh'
      shell: bash
